<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOMO æ–°æ˜¥è³€å¡ DIY</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; background-color: #0c152a; color: #fff; padding: 20px; text-align: center; }
        h2 { color: #D4AF37; margin-bottom: 10px; }
        
        /* ç•«å¸ƒå®¹å™¨ */
        .canvas-container { margin: 20px auto; max-width: 100%; overflow: hidden; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        canvas { max-width: 100%; height: auto; display: block; }

        /* è¼¸å…¥å€ */
        .controls { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; }
        input, select { padding: 10px; border-radius: 5px; border: 1px solid #D4AF37; background: #1e293b; color: white; font-size: 16px; }
        
        /* æŒ‰éˆ• */
        .btn { padding: 12px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; font-weight: bold; width: 100%; }
        .btn-preview { background-color: #334155; color: #fff; }
        .btn-download { background-color: #D4AF37; color: #0c152a; margin-top: 10px; }
        
        .hidden { display: none; }
    </style>
</head>
<body>

    <h2>ğŸ§¨ æ–°æ˜¥è³€å¡ DIY</h2>
    <p style="color:#aaa; font-size:12px;">è¼¸å…¥åå­—ï¼Œè£½ä½œå°ˆå±¬è³€å¡é€è¦ªå‹ï¼</p>

    <div class="controls">
        <select id="bgSelect" onchange="drawCard()">
            <option value="bg1">æ¬¾å¼ä¸€ï¼šé‡‘è›‡è¿æ˜¥</option>
            <option value="bg2">æ¬¾å¼äºŒï¼šå¯Œè²´æ»¿å ‚</option>
            <option value="bg3">æ¬¾å¼ä¸‰ï¼šè²¡æºæ»¾æ»¾</option>
        </select>
        
        <input type="text" id="userName" placeholder="è«‹è¼¸å…¥æ‚¨çš„åå­— (ä¾‹å¦‚: å°æ‘©)" maxlength="6" oninput="drawCard()">
        
        <select id="greetingSelect" onchange="drawCard()">
            <option value="ç¥æ‚¨ 2025 è›‡å¹´è¡Œå¤§é‹ï¼">ç¥æ‚¨ 2025 è›‡å¹´è¡Œå¤§é‹ï¼</option>
            <option value="æ–°çš„ä¸€å¹´ï¼Œè²¡å¯Œç¿»å€ï¼">æ–°çš„ä¸€å¹´ï¼Œè²¡å¯Œç¿»å€ï¼</option>
            <option value="è‚¡å¸‚é•·ç´…ï¼Œç²åˆ©æ»¿æ»¿ï¼">è‚¡å¸‚é•·ç´…ï¼Œç²åˆ©æ»¿æ»¿ï¼</option>
        </select>
    </div>

    <div class="canvas-container">
        <canvas id="myCanvas" width="800" height="600"></canvas>
    </div>

    <button id="btn-save" class="btn btn-download" onclick="downloadImage()">â¬‡ï¸ ä¸‹è¼‰åœ–ç‰‡å‚³çµ¦å¥½å‹</button>
    <p style="font-size: 12px; color: #aaa; margin-top: 10px;">(ä¸‹è¼‰å¾Œï¼Œå¯ç›´æ¥åœ¨ LINE å‚³é€åœ–ç‰‡çµ¦è¦ªå‹)</p>

    <script>
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        
        // åº•åœ–é€£çµ (é€™è£¡å…ˆç”¨ä½”ä½åœ–ï¼Œå¯¦ä½œæ™‚æ›æˆä½ çš„åœ–ç‰‡ URLï¼Œéœ€æ”¯æ´ CORS)
        const bgImages = {
            'bg1': 'https://via.placeholder.com/800x600/800000/D4AF37?text=Background+1', 
            'bg2': 'https://via.placeholder.com/800x600/0c152a/D4AF37?text=Background+2',
            'bg3': 'https://via.placeholder.com/800x600/D4AF37/000000?text=Background+3'
        };

        let currentBg = new Image();
        // è§£æ±ºè·¨åŸŸå•é¡Œ (é‡è¦ï¼šä½ çš„åœ–ç‰‡ä¼ºæœå™¨å¿…é ˆå…è¨± Access-Control-Allow-Origin)
        currentBg.crossOrigin = "Anonymous"; 

        // åˆå§‹åŒ–
        window.onload = function() {
            // åˆå§‹åŒ– LIFF (é¸æ“‡æ€§ï¼Œè‹¥è¦æŠ“å–ç”¨æˆ¶åå­—è‡ªå‹•å¡«å…¥)
            // liff.init({ liffId: "YOUR_LIFF_ID" }).then(() => { ... });
            
            currentBg.src = bgImages['bg1'];
            currentBg.onload = () => drawCard();
        };

        // æ ¸å¿ƒç¹ªåœ–é‚è¼¯
        function drawCard() {
            const name = document.getElementById('userName').value || "æ‚¨çš„åå­—";
            const greeting = document.getElementById('greetingSelect').value;
            const bgKey = document.getElementById('bgSelect').value;

            // 1. å¦‚æœæ›äº†èƒŒæ™¯ï¼Œé‡æ–°è¼‰å…¥
            if (!currentBg.src.includes(bgImages[bgKey])) {
                currentBg.src = bgImages[bgKey];
                currentBg.onload = () => drawContent(name, greeting);
            } else {
                drawContent(name, greeting);
            }
        }

        function drawContent(name, greeting) {
            // æ¸…é™¤ç•«å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 1. ç•«åº•åœ–
            ctx.drawImage(currentBg, 0, 0, canvas.width, canvas.height);

            // 2. è¨­å®šæ–‡å­—æ¨£å¼ (ç¥ç¦èª)
            ctx.fillStyle = "#ffffff";
            ctx.font = "bold 40px sans-serif";
            ctx.textAlign = "center";
            ctx.shadowColor = "rgba(0,0,0,0.5)";
            ctx.shadowBlur = 5;
            // ç•«åœ¨ä¸­é–“
            ctx.fillText(greeting, canvas.width / 2, canvas.height / 2 + 50);

            // 3. è¨­å®šæ–‡å­—æ¨£å¼ (ç½²å)
            ctx.fillStyle = "#D4AF37"; // é‡‘è‰²
            ctx.font = "bold 30px sans-serif";
            ctx.textAlign = "right";
            // ç•«åœ¨å³ä¸‹è§’
            ctx.fillText("â€” " + name + " æ•¬è³€", canvas.width - 50, canvas.height - 50);
            
            // 4. (é¸ç”¨) ç•«ä¸Šä½ çš„å“ç‰Œ LOGO æˆ–æ–‡å­—
            ctx.font = "20px sans-serif";
            ctx.fillStyle = "rgba(255,255,255,0.5)";
            ctx.textAlign = "left";
            ctx.fillText("MOMO è²¡å•†æ™ºåº«", 20, canvas.height - 20);
        }

        // ä¸‹è¼‰åœ–ç‰‡åŠŸèƒ½
        function downloadImage() {
            const link = document.createElement('a');
            link.download = 'MOMO_NewYear_Card.png';
            // å°‡ Canvas è½‰ç‚ºåœ–ç‰‡é€£çµ
            link.href = canvas.toDataURL("image/png");
            link.click();
        }
    </script>
</body>
</html>
